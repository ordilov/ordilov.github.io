---
layout: post
title:  "CORS"
date:   2022-01-06 00:45:00 +0900
category: web
tags: ["backend"]
keywords: ["backend"]
description: CORS 문제를 알아봅니다.
---

# Cross-Origin Resource Sharing
팀 프로젝트를 하다가 자주 마주친 문제였습니다.  
당시에는 깊게 파볼 생각을 못하고 단순히 해결책만 찾아서 적용했습니다.  
하지만 웹 개발자로써 문제에 대해 다시 생각해보기로 했습니다.  

## 왜 CORS를 막았을까? 
CORS를 막은 이유는 '보안' 때문입니다.  
웹에서 보안적으로 위험한 경우로 **CSRF**와 **XSS**가 있습니다.  
CSRF는 간단하게 웹에서 이미지 링크 같은 걸 누르면 사용자의 정보로 악용 요청을 보내는 겁니다.
XSS는 주로 입력 값을 악용해 사용자 정보를 다른 서버에 전송합니다.  
둘다 공통점이 있다면 원하지 않는 요청을 보낸다는 것에 있습니다.  
웹 개발자가 보안에 신경 쓴다면 이런 경우를 막을 수 있겠지만 근본적으로 막을 필요가 있습니다.  
CORS는 이런 악용을 막기 위해 기본적으로 다른 도메인으로의 요청을 막습니다.  

## 그래도 필요하다면?
웹을 개발하다보면 다른 서버에 요청할 일이 많습니다.  
API를 호출할 수도 있고, 이미지나 리소스등을 불러올 일들이 있습니다.  
이럴 때 CORS를 안전하게 사용하기 위해서는 서버에서 설정이 필요합니다.  
Access-Control-Allow-Origin에 가능한 요청들을 명시하면 됩니다.  
허용한 도메인이 아니라면 응답이 실패하게 됩니다.  
허용할 때 도메인 뿐만 아니라 허용할 메서드도 지정할 수 있습니다.  
서버에서 허용하는 목록이 있기 때문에 다른 오리진에 요청할 때는 서버를 먼저 거치게 됩니다.  
브라우저는 preflight 요청을 먼저 보내 서버에서 허용하는 목록에 있는지 확인합니다.  
허용한다는 응답을 받게 되면 그 다음으로 실제 요청이 가게 됩니다.  
그래서 외부로 요청하는 걸 브라우저로 확인해보면 요청이 2번 가는 것을 확인할 수 있습니다.  
그 중 먼저 요청이 간 부분은 preflight로 명시되어 있는 것을 확인할 수 있습니다.  
그리고 두번째 요청에 헤더에는 보낸 웹사이트의 주소가 Origin 필드에 들어가게 됩니다.  

