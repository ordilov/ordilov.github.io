<!DOCTYPE html><html><head><title class="jsx-a85e3c6bf5ace4eb">Ordinary</title><meta charSet="utf-8" class="jsx-a85e3c6bf5ace4eb"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-a85e3c6bf5ace4eb"/><meta name="description" content="Blog" class="jsx-a85e3c6bf5ace4eb"/><link rel="icon" href="/favicon.ico" class="jsx-a85e3c6bf5ace4eb"/><meta name="next-head-count" content="5"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-82797a600c079ab5.js" defer=""></script><script src="/_next/static/chunks/main-a054bbf31fb90f6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-25b5cf532b4ab4b8.js" defer=""></script><script src="/_next/static/chunks/969-234addc80d5a285b.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-4bf71c86b621edf7.js" defer=""></script><script src="/_next/static/4bh6z0mcBcNlg4jgixfJn/_buildManifest.js" defer=""></script><script src="/_next/static/4bh6z0mcBcNlg4jgixfJn/_ssgManifest.js" defer=""></script><script src="/_next/static/4bh6z0mcBcNlg4jgixfJn/_middlewareManifest.js" defer=""></script><style id="__jsx-a85e3c6bf5ace4eb">.header.jsx-a85e3c6bf5ace4eb{color:#0070f3;
background-color:#1e1e1e;
padding:20px;
border-bottom:1px solid #e5e5e5}
.headerLeft.jsx-a85e3c6bf5ace4eb{font-size:20pt;
font-family:'Source Sans Pro', sans-serif;
display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex:1;
-ms-flex:1;
flex:1;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
-webkit-text-decoration:none;
text-decoration:none}
.headerRight.jsx-a85e3c6bf5ace4eb{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
-webkit-flex:3;
-ms-flex:3;
flex:3;
-webkit-align-items:center;
-webkit-box-align:center;
-ms-flex-align:center;
align-items:center;
-webkit-flex-direction:row-reverse;
-ms-flex-direction:row-reverse;
flex-direction:row-reverse}</style><style id="__jsx-3340924647">a.jsx-3340924647{display:block;
margin-left:20px;
padding-left:0.3rem;
padding-top:0.5rem;
padding-bottom:0.5rem;
width:120px;
-webkit-text-decoration:none;
text-decoration:none;
color:#FFF;
font-size:8pt;
border-bottom:1px solid #ccc}
[aria-current].jsx-3340924647:not([aria-current="false"]){font-weight:bold;
color:red}</style><style id="__jsx-d3a8789621931ffd">aside.jsx-d3a8789621931ffd{position:absolute;
right:0;
width:200px;
height:100%}
nav.jsx-d3a8789621931ffd{top:200px;
padding:0 0 0 10px;
display:inline-block;
position:-webkit-sticky;
position:sticky}
ul.jsx-d3a8789621931ffd{list-style:none}
@media (max-width:1080px) {aside.jsx-d3a8789621931ffd{visibility:hidden}}</style><style id="__jsx-44892c5bd5256dd3">article.jsx-44892c5bd5256dd3{display:block;
margin:0 auto;
padding:0 1rem}
@media (max-width:800px) {aside.jsx-44892c5bd5256dd3{position:static;
height:auto}}
.title.jsx-44892c5bd5256dd3{font-size:30pt;
margin-bottom:5px}
.head.jsx-44892c5bd5256dd3{margin-bottom:2rem}
.avatar.jsx-44892c5bd5256dd3{margin-right:0.5rem}
.meta.jsx-44892c5bd5256dd3{display:-webkit-box;
display:-webkit-flex;
display:-ms-flexbox;
display:flex;
margin-right:0.5rem}
.profile.jsx-44892c5bd5256dd3{color:#A0AEC0;
line-height:1.5;
margin-right:0.5rem}
.container.jsx-44892c5bd5256dd3{width:100%;
max-width:700px;
margin:0 auto;
line-height:1.625}</style><style id="__jsx-76612a042023d019">footer.jsx-76612a042023d019{background-color:#1e1e1e;
padding:20px;
text-align:center}</style><style id="__jsx-853d05b23ef572e2">.container.jsx-853d05b23ef572e2{position:relative;
padding:0 2rem}
@media (min-width:900px) {.container.jsx-853d05b23ef572e2{position:relative;
max-width:1080px;
padding:0 2rem;
margin-left:auto;
margin-right:auto}}</style><style id="__jsx-909d5f1975c32443">html, body{padding:0;
margin:0;
font-family:-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif;
background:#1e1e1e}
a{color:inherit;
-webkit-text-decoration:none;
text-decoration:none}
*{color:white;
box-sizing:border-box}
main{background-color:#1e1e1e}
strong{color:#a964a7}
code{color:#3fd0c0;
font-weight:bold;
font-family:-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans, Droid Sans, Helvetica Neue, sans-serif}
blockquote{border:3px solid #27a9e3;
margin-left:0;
margin-right:0;
padding-left:20px;
padding-right:20px;
border-left:12px solid #27a9e3;
border-radius:5px}
article{position:relative}
.hljs{font-size:1rem;
background:#333;
font-family:SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
display:block;
color:#fff;
border-radius:5px;
overflow:auto;
padding:1em;
margin:0.6em}
.hljs-doctag, .hljs-meta-keyword, .hljs-name, .hljs-strong{font-weight:bold}
.hljs-code, .hljs-emphasis{font-style:italic}
.hljs-section, .hljs-tag{color:#62c8f3}
.hljs-selector-class, .hljs-selector-id, .hljs-template-variable, .hljs-variable{color:#ade5fc}
.hljs-meta-string, .hljs-string{color:#a2fca2}
.hljs-attr, .hljs-quote, .hljs-selector-attr{color:#7bd694}
.hljs-tag .hljs-attr{color:inherit}
.hljs-attribute, .hljs-title, .hljs-type{color:#ffa}
.hljs-number, .hljs-symbol{color:#d36363}
.hljs-bullet, .hljs-template-tag{color:#b8d8a2}
.hljs-built_in, .hljs-keyword, .hljs-literal, .hljs-selector-tag{color:#fcc28c}
.hljs-code, .hljs-comment, .hljs-formula{color:#888}
.hljs-link, .hljs-selector-pseudo, .hljs-regexp{color:#c6b4f0}
.hljs-meta{color:#fc9b9b}
.hljs-deletion{background:#fc9b9b;
color:#333}
.hljs-addition{background:#a2fca2;
color:#333}
.hljs-operator, .hljs-params, .hljs-property, .hljs-punctuation{}
.hljs-subst{color:#fff}
.hljs a{color:inherit}
.hljs a:focus, .hljs a:hover{color:inherit;
text-decoration:underline}
.hljs mark{background:#555;
color:inherit}</style></head><body><div id="__next" data-reactroot=""><div class="jsx-853d05b23ef572e2 container"><div class="jsx-a85e3c6bf5ace4eb header"><div class="jsx-a85e3c6bf5ace4eb headerLeft"><a href="/">Ordinary</a></div><div class="jsx-a85e3c6bf5ace4eb headerRight"><a class="jsx-a85e3c6bf5ace4eb" href="/about">About</a></div></div><div class="jsx-44892c5bd5256dd3"><aside class="jsx-d3a8789621931ffd"><nav class="jsx-d3a8789621931ffd"><ul class="jsx-d3a8789621931ffd"><li class="jsx-3340924647"><a href="#AuthenticationEntryPoint" class="jsx-3340924647"> <!-- -->AuthenticationEntryPoint</a></li><li class="jsx-3340924647"><a href="#Filter 중간에서 처리" class="jsx-3340924647"> <!-- -->Filter 중간에서 처리</a></li></ul></nav></aside><article class="jsx-44892c5bd5256dd3 container"><div class="jsx-44892c5bd5256dd3 head"><h1 class="jsx-44892c5bd5256dd3 title">Spring Filter 내부 Exception</h1><div class="jsx-44892c5bd5256dd3 meta"><img src="/profile.png" alt="profile" class="jsx-44892c5bd5256dd3 avatar"/><div class="jsx-44892c5bd5256dd3 profile">ordilov /<!-- --> <!-- -->2022. 3. 7</div></div></div><p class=".Paragraph.jsx-c13bd6d988b6c83{line-height:1.625}">@RestControllerAdvice로 에러를 전역처리하는데 filter 내부에서 에러는 처리되지 않았습니다.
이 경우 처리를 위해서 겪을 수 있는 문제점들이 있습니다.</p>
<div id="AuthenticationEntryPoint"><h3>AuthenticationEntryPoint</h3></div>
<p class=".Paragraph.jsx-c13bd6d988b6c83{line-height:1.625}">인증되지 않은 에러인 401 에러인 경우 필터를 거치고 AuthenticationEntryPoint 구현체에서 에러가 처리됩니다.
이 인터페이스를 구현하고 commence 메서드를 오버라이드하면 커스텀 처리가 가능해집니다.</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestAuthenticationEntryPoint</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AuthenticationEntryPoint</span> {

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commence</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
      AuthenticationException e)</span> <span class="hljs-keyword">throws</span> IOException {
    log.error(<span class="hljs-string">&quot;잘못된 인증 요청이 들어왔습니다. Message - {}&quot;</span>, e.getMessage());

    <span class="hljs-type">ErrorCode</span> <span class="hljs-variable">errorCode</span> <span class="hljs-operator">=</span> (ErrorCode) request.getAttribute(<span class="hljs-string">&quot;errorCode&quot;</span>);
    <span class="hljs-keyword">if</span> (errorCode == <span class="hljs-literal">null</span>) {
      errorCode = ErrorCode.UNAUTHORIZED;
    }

    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
    <span class="hljs-type">String</span> <span class="hljs-variable">error</span> <span class="hljs-operator">=</span> mapper.writeValueAsString(CommonResponse.fail(errorCode));

    response.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);
    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
    response.setContentType(MediaType.APPLICATION_JSON_VALUE);
    response.getWriter().write(error);
  }
}
</code></pre>
<div id="Filter 중간에서 처리"><h3>Filter 중간에서 처리</h3></div>
<p class=".Paragraph.jsx-c13bd6d988b6c83{line-height:1.625}">Fitler 중간에서 메서드 파리미터로 넘어온 HttpServletResponse를 이용해 중간에 응답을 보낼 수 있습니다.
방법으로는 sendError 메서드를 이용하거나 response에 write 하는 방식으로 중간에 응답을 보내면 됩니다.
하지만 중간에서 처리하는 경우 응답 보낸 response를 다음 filter로 보내면 안됩니다.
응답이 이미 처리된 형태이기 때문에 다음 필터로 넘어가면 에러가 발생합니다.</p>
<pre><code class="hljs language-java">response.sendError(HttpServletResponse.SC_UNAUTHORIZED, <span class="hljs-string">&quot;Unauthorized&quot;</span>);

...

filterChain.doFilter(request, response); <span class="hljs-comment">// 에러 </span>
</code></pre></article></div><footer class="jsx-76612a042023d019"></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"layout":"post","title":"Spring Filter 내부 Exception","date":"2022-03-08 00:01:00 +0900","category":"trouble","tags":["trouble"],"keywords":["trouble"],"id":"Filter 내부 Exception"},"mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      h3: \"h3\",\n      pre: \"pre\",\n      code: \"code\",\n      span: \"span\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.p, {\n        children: \"@RestControllerAdvice로 에러를 전역처리하는데 filter 내부에서 에러는 처리되지 않았습니다.\\n이 경우 처리를 위해서 겪을 수 있는 문제점들이 있습니다.\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"AuthenticationEntryPoint\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"인증되지 않은 에러인 401 에러인 경우 필터를 거치고 AuthenticationEntryPoint 구현체에서 에러가 처리됩니다.\\n이 인터페이스를 구현하고 commence 메서드를 오버라이드하면 커스텀 처리가 가능해집니다.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"RestAuthenticationEntryPoint\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"implements\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"AuthenticationEntryPoint\"\n          }), \" {\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Override\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title function_\",\n            children: \"commence\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(HttpServletRequest request, HttpServletResponse response,\\n      AuthenticationException e)\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"throws\"\n          }), \" IOException {\\n    log.error(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"잘못된 인증 요청이 들어왔습니다. Message - {}\\\"\"\n          }), \", e.getMessage());\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"ErrorCode\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"errorCode\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" (ErrorCode) request.getAttribute(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"errorCode\\\"\"\n          }), \");\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"if\"\n          }), \" (errorCode == \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \") {\\n      errorCode = ErrorCode.UNAUTHORIZED;\\n    }\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"ObjectMapper\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"mapper\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title class_\",\n            children: \"ObjectMapper\"\n          }), \"();\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"String\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"error\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" mapper.writeValueAsString(CommonResponse.fail(errorCode));\\n\\n    response.setCharacterEncoding(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"UTF-8\\\"\"\n          }), \");\\n    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);\\n    response.setContentType(MediaType.APPLICATION_JSON_VALUE);\\n    response.getWriter().write(error);\\n  }\\n}\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"Filter 중간에서 처리\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Fitler 중간에서 메서드 파리미터로 넘어온 HttpServletResponse를 이용해 중간에 응답을 보낼 수 있습니다.\\n방법으로는 sendError 메서드를 이용하거나 response에 write 하는 방식으로 중간에 응답을 보내면 됩니다.\\n하지만 중간에서 처리하는 경우 응답 보낸 response를 다음 filter로 보내면 안됩니다.\\n응답이 이미 처리된 형태이기 때문에 다음 필터로 넘어가면 에러가 발생합니다.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [\"response.sendError(HttpServletResponse.SC_UNAUTHORIZED, \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Unauthorized\\\"\"\n          }), \");\\n\\n...\\n\\nfilterChain.doFilter(request, response); \", _jsx(_components.span, {\n            className: \"hljs-comment\",\n            children: \"// 에러 \"\n          }), \"\\n\"]\n        })\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"Filter 내부 Exception"},"buildId":"4bh6z0mcBcNlg4jgixfJn","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>