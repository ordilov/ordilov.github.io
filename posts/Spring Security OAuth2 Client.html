<!DOCTYPE html><html><head><title>Ordinary</title><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Blog"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/f30e95c4ef9a5ce6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f30e95c4ef9a5ce6.css" data-n-g=""/><link rel="preload" href="/_next/static/css/b8560289fc67afa8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b8560289fc67afa8.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-fd1bc4a65a80e5c8.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-a054bbf31fb90f6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-10d16e51767f2eb7.js" defer=""></script><script src="/_next/static/chunks/132-c8ad25a4bdd62a00.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-4c91ca1952ea948f.js" defer=""></script><script src="/_next/static/C_hZnuebhS8O93_BuECK4/_buildManifest.js" defer=""></script><script src="/_next/static/C_hZnuebhS8O93_BuECK4/_ssgManifest.js" defer=""></script><script src="/_next/static/C_hZnuebhS8O93_BuECK4/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Home_container__97eC3"><div class="Header_header__ubBbX"><div class="Header_headerLeft__gJBl3"><a href="/">Ordinary</a></div><div class="Header_headerRight__uflv6"><a href="/about">About</a></div></div><article class="Post_container__qv178"><div class="Post_head__hU8yK"><h1 class="Post_title__MJ8Hr">Spring Security OAuth2 Client Refresh Token</h1><div class="Post_meta__TGwfg"><img src="/profile.png" class="Post_avatar__KIFLy" alt="profile"/><div class="Post_profile__wwScp">ordilov /<!-- --> <!-- -->2/9/202</div></div></div><div style="--size:20pt" class="MDX_Heading__T63mn">Google OAuth2 Refresh Token</div>
<p class="MDX_Paragraph__xqVvo"><code>구글</code> OAuth2 기준 다른 설정 없이 Authorization Code 로 Token을 받으면 refresh Token을 받을 수 없습니다.
구글 OAuth2에서 refresh token을 요청하려면 필요한 조건들이 있습니다.</p>
<ul>
<li>access_type : offline 설정</li>
<li>prompt : consent (처믕 설정 시)</li>
</ul>
<p class="MDX_Paragraph__xqVvo">access_type 옵션은 브라우저가 아닌 서버에서 재요청하기 위해 refresh token을 요청하는 옵션입니다.
prompt는 OAuth2 인증을 위해 요청하는 화면이 나오는 기준을 설정합니다.
설정하지 않으면 기본적으로 처음 요청시에만 확인을 받고 그 이후에는 받지 않습니다.
처음에 refresh token을 받았으면 상관 없지만 테스트를 위해 refresh token을 확인하고 싶은 경우 consent를 설정해야 합니다.
그 이유는 구글에서 refresh token은 사용자에게 직접 인증을 받는 순간에만 제공됩니다.
그 이후에는 access_type이 offline 이더라도 이미 인증 받은 경우 refresh token이 제공되지 않습니다.</p>
<div style="--size:20pt" class="MDX_Heading__T63mn">Spring Security OAuth2 Client에서 설정하기</div>
<p class="MDX_Paragraph__xqVvo">spring security oauth2 client를 사용하면 oauth2 연결을 쉽게 사용할 수 있습니다.
application.yml에서 client-id와 client-secret 그리고 인증을 받을 범위등 옵션등을 설정할 수 있습니다.</p>
<pre><code class="hljs language-yaml">  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">oauth2:</span>
      <span class="hljs-attr">client:</span>
        <span class="hljs-attr">registration:</span>
          <span class="hljs-attr">google:</span>
            <span class="hljs-attr">client-id:</span> {<span class="hljs-string">client-id</span>}
            <span class="hljs-attr">client-secret:</span> {<span class="hljs-string">client-secret</span>}
            <span class="hljs-attr">redirectUri:</span> <span class="hljs-string">&quot;{baseUrl}/oauth2/callback/{registrationId}&quot;</span>
            <span class="hljs-attr">scope:</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">email</span>
              <span class="hljs-bullet">-</span> <span class="hljs-string">profile</span>
</code></pre>
<p class="MDX_Paragraph__xqVvo">하지만 yml 설정에서 할 수 없는 부분은 refresh token을 받기 위한 설정을 추가할 수 없습니다.
access_type이나 prompt 같은 옵션 파라미터를 추가하려면 추가적인 설정이 필요합니다.
설정할 수 있는 방법은 두 가지가 방법이 있습니다.</p>
<div style="--size:18pt" class="MDX_Heading__T63mn">ClientRegistrationRepository 수정하기</div>
<p class="MDX_Paragraph__xqVvo">ClientRegistrationRepository는 위에서 등록한 client registration들을 불러와 정보들을 보관합니다.
여기에서 인증 요청을 위해 사용되는 주소는 <code>authorizationUri</code>입니다.
이 주소 뒤에 필요한 파라미터 쿼리를 추가해주면 됩니다.
access_type을 추가한다면 다음과 같은 주소가 됩니다.</p>
<blockquote>
<p class="MDX_Paragraph__xqVvo">&quot;https://accounts.google.com/o/oauth2/v2/auth/?access_type=offline&quot;</p>
</blockquote>
<pre><code class="hljs language-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">OAuth2LoginConfig</span> {

	<span class="hljs-meta">@Bean</span>
	<span class="hljs-keyword">public</span> ClientRegistrationRepository <span class="hljs-title hljs-function">clientRegistrationRepository</span><span class="hljs-params">()</span> {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title hljs-class">InMemoryClientRegistrationRepository</span>(<span class="hljs-built_in">this</span>.googleClientRegistration());
	}

	<span class="hljs-keyword">private</span> ClientRegistration <span class="hljs-title hljs-function">googleClientRegistration</span><span class="hljs-params">()</span> {
		<span class="hljs-keyword">return</span> ClientRegistration.withRegistrationId(<span class="hljs-string">&quot;google&quot;</span>)
			.clientId(<span class="hljs-string">&quot;google-client-id&quot;</span>)
			.clientSecret(<span class="hljs-string">&quot;google-client-secret&quot;</span>)
			.clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)
			.authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
			.redirectUri(<span class="hljs-string">&quot;{baseUrl}/login/oauth2/code/{registrationId}&quot;</span>)
			.scope(<span class="hljs-string">&quot;openid&quot;</span>, <span class="hljs-string">&quot;profile&quot;</span>, <span class="hljs-string">&quot;email&quot;</span>, <span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-string">&quot;phone&quot;</span>)
			.authorizationUri(<span class="hljs-string">&quot;https://accounts.google.com/o/oauth2/v2/auth&quot;</span>)
			.tokenUri(<span class="hljs-string">&quot;https://www.googleapis.com/oauth2/v4/token&quot;</span>)
			.userInfoUri(<span class="hljs-string">&quot;https://www.googleapis.com/oauth2/v3/userinfo&quot;</span>)
			.userNameAttributeName(IdTokenClaimNames.SUB)
			.jwkSetUri(<span class="hljs-string">&quot;https://www.googleapis.com/oauth2/v3/certs&quot;</span>)
			.clientName(<span class="hljs-string">&quot;Google&quot;</span>)
			.build();
	}
}
</code></pre>
<p class="MDX_Paragraph__xqVvo">스프링 공식 문서에서 제공하는 ClientRegistration 구성 코드입니다.
하지만 설명에는 모든 설정이 하드코딩된 형태로 보통 이렇게 client-id 나 client-secret을 공개된 형태로 사용하지 않습니다.
위에서 사용하듯이 yml처럼 환경 변수로 코드 밖에서 따로 관리하길 원합니다.
따로 환경 변수를 불러올 수도 있지만, oauth2 client에서 기본적으로 설정한 구성을 그대로 불러오고 싶을 수 있습니다.
이 경우 Spring에서는 <code>OAuth2ClientProperties</code> 클래스를 통해 불러올 수 있습니다.
따라서 위의 코드를 수정하면 다음과 같은 형태가 됩니다.</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">OAuth2LoginConfig</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OAuth2ClientProperties properties;

  <span class="hljs-meta">@Bean</span>
  <span class="hljs-keyword">public</span> ClientRegistrationRepository <span class="hljs-title hljs-function">clientRegistrationRepository</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title hljs-class">InMemoryClientRegistrationRepository</span>(<span class="hljs-built_in">this</span>.googleClientRegistration());
  }

  <span class="hljs-keyword">private</span> ClientRegistration <span class="hljs-title hljs-function">googleClientRegistration</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Registration</span> <span class="hljs-variable">googleRegistration</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.properties.getRegistration().get(<span class="hljs-string">&quot;google&quot;</span>);
    
    <span class="hljs-keyword">return</span> ClientRegistration.withRegistrationId(<span class="hljs-string">&quot;google&quot;</span>)
        .clientId(googleRegistration.getClientId())
        .clientSecret(googleRegistration.getClientSecret())
        .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)
        .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
        .redirectUri(<span class="hljs-string">&quot;{baseUrl}/login/oauth2/code/{registrationId}&quot;</span>)
        .scope(<span class="hljs-string">&quot;openid&quot;</span>, <span class="hljs-string">&quot;profile&quot;</span>, <span class="hljs-string">&quot;email&quot;</span>, <span class="hljs-string">&quot;address&quot;</span>, <span class="hljs-string">&quot;phone&quot;</span>)
        .authorizationUri(<span class="hljs-string">&quot;https://accounts.google.com/o/oauth2/v2/auth/?access_type=offline&quot;</span>)
        .tokenUri(<span class="hljs-string">&quot;https://www.googleapis.com/oauth2/v4/token&quot;</span>)
        .userInfoUri(<span class="hljs-string">&quot;https://www.googleapis.com/oauth2/v3/userinfo&quot;</span>)
        .userNameAttributeName(IdTokenClaimNames.SUB)
        .jwkSetUri(<span class="hljs-string">&quot;https://www.googleapis.com/oauth2/v3/certs&quot;</span>)
        .clientName(<span class="hljs-string">&quot;Google&quot;</span>)
        .build();
  }
}
</code></pre>
<p class="MDX_Paragraph__xqVvo">google이 아니더라도 registration에 등록한 키 값을 기준으로 불러와 속성들을 가져와 사용할 수 있습니다.</p>
<div style="--size:18pt" class="MDX_Heading__T63mn">CustomAuthorizationRequestResolver 추가하기</div>
<p class="MDX_Paragraph__xqVvo">ClientRegistrationRepository를 수정하는 것도 방법이지만 옵션만 추가하는 건데 등록 정보 전부를 불러오는 건 번거로울 수 있습니다.
다른 방법으로는 AuthorizationRequestResolver를 구현하는 방법으로 request에 resolver를 추가할 수 있습니다.
AuthorizationRequestResolver를 구현하고 나면 추가할 위치는 다음 코드와 같습니다.</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-meta">@RequiredArgsConstructor</span> 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title hljs-class">WebSecurityConfigurerAdapter</span> {

 <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ClientRegistrationRepository clientRegistrationRepository;

 <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title hljs-function">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
    http.
    .oauth2Login()
        .authorizationEndpoint()
        .authorizationRequestResolver(customAuthorizationRequestResolver))
</code></pre>
<p class="MDX_Paragraph__xqVvo">AuthorizationRequestResolver는 ClientRegistrationRepository를 생성 파라미터로 받습니다.
이 코드는 Spring docs에서 제공하는 파리미터를 수정하는 코드에서 access_type을 추가한 코드입니다.
코드를 살펴보면 생성자로 ClientRegistrationRepository를 주입 받습니다.
위에서 ClientRegistationRepository를 수정했다면 중복해서 처리되므로 하나만 선택해서 설정해야 합니다.
다음으로 OAuth2AuthorizationRequestResolver로 DefaultOAuth2AuthorizationRequestResolver를 만들어서 사용합니다.
구현하는 클래스를 필드값으로 갖고 있는 이유는 DefaultOAuth2AuthorizationRequestResolver는 final 클래스로 상속받을 수 없습니다.
상속받을 수 없지만 Spring에서 기본적으로 사용하는 위 클래스가 구현하는 기능이 많기 때문에 가져와서 쓰는 것이 편합니다.
모든 기능을 그대로 복사해서 사용해도 되지만 그것도 마찬가지로 중복이 많아지게 됩니다.
따라서 필드값으로 사용해서 기본 기능을 실행하고 추가적인 옵션을 넣는 식으로 구현됩니다.</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title hljs-class">CustomAuthorizationRequestResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title hljs-class">OAuth2AuthorizationRequestResolver</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OAuth2AuthorizationRequestResolver defaultAuthorizationRequestResolver;

  <span class="hljs-keyword">public</span> <span class="hljs-title hljs-function">CustomAuthorizationRequestResolver</span><span class="hljs-params">(
      ClientRegistrationRepository clientRegistrationRepository)</span> {

    <span class="hljs-built_in">this</span>.defaultAuthorizationRequestResolver =
        <span class="hljs-keyword">new</span> <span class="hljs-title hljs-class">DefaultOAuth2AuthorizationRequestResolver</span>(
            clientRegistrationRepository, <span class="hljs-string">&quot;/oauth2/authorize&quot;</span>);
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> OAuth2AuthorizationRequest <span class="hljs-title hljs-function">resolve</span><span class="hljs-params">(HttpServletRequest request)</span> {
    <span class="hljs-type">OAuth2AuthorizationRequest</span> <span class="hljs-variable">authorizationRequest</span> <span class="hljs-operator">=</span>
        <span class="hljs-built_in">this</span>.defaultAuthorizationRequestResolver.resolve(request);

    <span class="hljs-keyword">return</span> authorizationRequest != <span class="hljs-literal">null</span> ?
        customAuthorizationRequest(authorizationRequest) :
        <span class="hljs-literal">null</span>;
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> OAuth2AuthorizationRequest <span class="hljs-title hljs-function">resolve</span><span class="hljs-params">(
      HttpServletRequest request, String clientRegistrationId)</span> {

    <span class="hljs-type">OAuth2AuthorizationRequest</span> <span class="hljs-variable">authorizationRequest</span> <span class="hljs-operator">=</span>
        <span class="hljs-built_in">this</span>.defaultAuthorizationRequestResolver.resolve(
            request, clientRegistrationId);

    <span class="hljs-keyword">return</span> authorizationRequest != <span class="hljs-literal">null</span> ?
        customAuthorizationRequest(authorizationRequest) :
        <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">private</span> OAuth2AuthorizationRequest <span class="hljs-title hljs-function">customAuthorizationRequest</span><span class="hljs-params">(
      OAuth2AuthorizationRequest authorizationRequest)</span> {

    Map&lt;String, Object&gt; additionalParameters =
        <span class="hljs-keyword">new</span> <span class="hljs-title hljs-class">LinkedHashMap</span>&lt;&gt;(authorizationRequest.getAdditionalParameters());
    additionalParameters.put(<span class="hljs-string">&quot;access_type&quot;</span>, <span class="hljs-string">&quot;offline&quot;</span>);
    additionalParameters.put(<span class="hljs-string">&quot;prompt&quot;</span>, <span class="hljs-string">&quot;consent&quot;</span>);

    <span class="hljs-keyword">return</span> OAuth2AuthorizationRequest.from(authorizationRequest)
        .additionalParameters(additionalParameters)
        .build();
  }
}
</code></pre>
<div style="--size:20pt" class="MDX_Heading__T63mn">Refresh Token 사용하기</div>
<p class="MDX_Paragraph__xqVvo">위에서 받아온 Refresh Token은 <code>OAuth2AuthorizedClientService</code>에서 관리됩니다.
따라서 사용할 클래스에서 Bean으로 주입받고 사용하면 됩니다.
OAuth2AuthorizedClientService에서 loadAuthorizedClient로 저장된 정보를 불러와 사용할 수 있습니다.</p>
<pre><code class="hljs language-java">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OAuth2AuthorizedClientService oAuth2AuthorizedClientService;

  <span class="hljs-type">OAuth2AuthorizedClient</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> oAuth2AuthorizedClientService.loadAuthorizedClient(<span class="hljs-string">&quot;google&quot;</span>, authentication.getName());
  <span class="hljs-type">OAuth2RefreshToken</span> <span class="hljs-variable">refreshToken</span> <span class="hljs-operator">=</span> user.getRefreshToken();
</code></pre>
<p class="MDX_Paragraph__xqVvo">Controller에서 사용하는 경우 다른 방법으로 받을 수 있습니다.</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@GetMapping(&quot;/foo&quot;)</span>
<span class="hljs-keyword">void</span> <span class="hljs-title hljs-function">foo</span><span class="hljs-params">(<span class="hljs-meta">@RegisteredOAuth2AuthorizedClient(&quot;google&quot;)</span> OAuth2AuthorizedClient user)</span> {
    <span class="hljs-type">OAuth2RefreshToken</span> <span class="hljs-variable">refreshToken</span> <span class="hljs-operator">=</span> user.getRefreshToken();
}
</code></pre>
<hr/>
<p class="MDX_Paragraph__xqVvo">이렇게 정리한 이유는 OAuth2 Access Token만으로 구현한 글들은 많이 접할 수 있었지만 Refresh Token은 많이 없었습니다.
로그인이 아니라 API를 호출하는 경우 이후에 토큰을 갱신하기 위해서 필요한데 생길 수 있는 문제를 정리해봤습니다.</p></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"layout":"post","title":"Spring Security OAuth2 Client Refresh Token","date":"2022-02-10 00:01:00 +0900","category":"backend","tags":["backend"],"keywords":["backend"],"id":"Spring Security OAuth2 Client"},"mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      h2: \"h2\",\n      p: \"p\",\n      code: \"code\",\n      ul: \"ul\",\n      li: \"li\",\n      pre: \"pre\",\n      span: \"span\",\n      h3: \"h3\",\n      blockquote: \"blockquote\",\n      hr: \"hr\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.h2, {\n        children: \"Google OAuth2 Refresh Token\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.code, {\n          children: \"구글\"\n        }), \" OAuth2 기준 다른 설정 없이 Authorization Code 로 Token을 받으면 refresh Token을 받을 수 없습니다.\\n구글 OAuth2에서 refresh token을 요청하려면 필요한 조건들이 있습니다.\"]\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"access_type : offline 설정\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"prompt : consent (처믕 설정 시)\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"access_type 옵션은 브라우저가 아닌 서버에서 재요청하기 위해 refresh token을 요청하는 옵션입니다.\\nprompt는 OAuth2 인증을 위해 요청하는 화면이 나오는 기준을 설정합니다.\\n설정하지 않으면 기본적으로 처음 요청시에만 확인을 받고 그 이후에는 받지 않습니다.\\n처음에 refresh token을 받았으면 상관 없지만 테스트를 위해 refresh token을 확인하고 싶은 경우 consent를 설정해야 합니다.\\n그 이유는 구글에서 refresh token은 사용자에게 직접 인증을 받는 순간에만 제공됩니다.\\n그 이후에는 access_type이 offline 이더라도 이미 인증 받은 경우 refresh token이 제공되지 않습니다.\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Spring Security OAuth2 Client에서 설정하기\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"spring security oauth2 client를 사용하면 oauth2 연결을 쉽게 사용할 수 있습니다.\\napplication.yml에서 client-id와 client-secret 그리고 인증을 받을 범위등 옵션등을 설정할 수 있습니다.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-yaml\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"security:\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"oauth2:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"client:\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"registration:\"\n          }), \"\\n          \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"google:\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"client-id:\"\n          }), \" {\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"client-id\"\n          }), \"}\\n            \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"client-secret:\"\n          }), \" {\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"client-secret\"\n          }), \"}\\n            \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"redirectUri:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"{baseUrl}/oauth2/callback/{registrationId}\\\"\"\n          }), \"\\n            \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"scope:\"\n          }), \"\\n              \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"email\"\n          }), \"\\n              \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"profile\"\n          }), \"\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"하지만 yml 설정에서 할 수 없는 부분은 refresh token을 받기 위한 설정을 추가할 수 없습니다.\\naccess_type이나 prompt 같은 옵션 파라미터를 추가하려면 추가적인 설정이 필요합니다.\\n설정할 수 있는 방법은 두 가지가 방법이 있습니다.\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"ClientRegistrationRepository 수정하기\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ClientRegistrationRepository는 위에서 등록한 client registration들을 불러와 정보들을 보관합니다.\\n여기에서 인증 요청을 위해 사용되는 주소는 \", _jsx(_components.code, {\n          children: \"authorizationUri\"\n        }), \"입니다.\\n이 주소 뒤에 필요한 파라미터 쿼리를 추가해주면 됩니다.\\naccess_type을 추가한다면 다음과 같은 주소가 됩니다.\"]\n      }), \"\\n\", _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsx(_components.p, {\n          children: \"\\\"https://accounts.google.com/o/oauth2/v2/auth/?access_type=offline\\\"\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Configuration\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"OAuth2LoginConfig\"\n          }), \" {\\n\\n\\t\", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Bean\"\n          }), \"\\n\\t\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" ClientRegistrationRepository \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"clientRegistrationRepository\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          }), \" {\\n\\t\\t\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"InMemoryClientRegistrationRepository\"\n          }), \"(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \".googleClientRegistration());\\n\\t}\\n\\n\\t\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" ClientRegistration \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"googleClientRegistration\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          }), \" {\\n\\t\\t\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" ClientRegistration.withRegistrationId(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"google\\\"\"\n          }), \")\\n\\t\\t\\t.clientId(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"google-client-id\\\"\"\n          }), \")\\n\\t\\t\\t.clientSecret(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"google-client-secret\\\"\"\n          }), \")\\n\\t\\t\\t.clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)\\n\\t\\t\\t.authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\\n\\t\\t\\t.redirectUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"{baseUrl}/login/oauth2/code/{registrationId}\\\"\"\n          }), \")\\n\\t\\t\\t.scope(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"openid\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"profile\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"email\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"address\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"phone\\\"\"\n          }), \")\\n\\t\\t\\t.authorizationUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://accounts.google.com/o/oauth2/v2/auth\\\"\"\n          }), \")\\n\\t\\t\\t.tokenUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://www.googleapis.com/oauth2/v4/token\\\"\"\n          }), \")\\n\\t\\t\\t.userInfoUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://www.googleapis.com/oauth2/v3/userinfo\\\"\"\n          }), \")\\n\\t\\t\\t.userNameAttributeName(IdTokenClaimNames.SUB)\\n\\t\\t\\t.jwkSetUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://www.googleapis.com/oauth2/v3/certs\\\"\"\n          }), \")\\n\\t\\t\\t.clientName(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Google\\\"\"\n          }), \")\\n\\t\\t\\t.build();\\n\\t}\\n}\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"스프링 공식 문서에서 제공하는 ClientRegistration 구성 코드입니다.\\n하지만 설명에는 모든 설정이 하드코딩된 형태로 보통 이렇게 client-id 나 client-secret을 공개된 형태로 사용하지 않습니다.\\n위에서 사용하듯이 yml처럼 환경 변수로 코드 밖에서 따로 관리하길 원합니다.\\n따로 환경 변수를 불러올 수도 있지만, oauth2 client에서 기본적으로 설정한 구성을 그대로 불러오고 싶을 수 있습니다.\\n이 경우 Spring에서는 \", _jsx(_components.code, {\n          children: \"OAuth2ClientProperties\"\n        }), \" 클래스를 통해 불러올 수 있습니다.\\n따라서 위의 코드를 수정하면 다음과 같은 형태가 됩니다.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Configuration\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@RequiredArgsConstructor\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"OAuth2LoginConfig\"\n          }), \" {\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"final\"\n          }), \" OAuth2ClientProperties properties;\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Bean\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" ClientRegistrationRepository \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"clientRegistrationRepository\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          }), \" {\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"InMemoryClientRegistrationRepository\"\n          }), \"(\", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \".googleClientRegistration());\\n  }\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" ClientRegistration \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"googleClientRegistration\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"()\"\n          }), \" {\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"Registration\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"googleRegistration\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \".properties.getRegistration().get(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"google\\\"\"\n          }), \");\\n    \\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" ClientRegistration.withRegistrationId(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"google\\\"\"\n          }), \")\\n        .clientId(googleRegistration.getClientId())\\n        .clientSecret(googleRegistration.getClientSecret())\\n        .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)\\n        .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\\n        .redirectUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"{baseUrl}/login/oauth2/code/{registrationId}\\\"\"\n          }), \")\\n        .scope(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"openid\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"profile\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"email\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"address\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"phone\\\"\"\n          }), \")\\n        .authorizationUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://accounts.google.com/o/oauth2/v2/auth/?access_type=offline\\\"\"\n          }), \")\\n        .tokenUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://www.googleapis.com/oauth2/v4/token\\\"\"\n          }), \")\\n        .userInfoUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://www.googleapis.com/oauth2/v3/userinfo\\\"\"\n          }), \")\\n        .userNameAttributeName(IdTokenClaimNames.SUB)\\n        .jwkSetUri(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"https://www.googleapis.com/oauth2/v3/certs\\\"\"\n          }), \")\\n        .clientName(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"Google\\\"\"\n          }), \")\\n        .build();\\n  }\\n}\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"google이 아니더라도 registration에 등록한 키 값을 기준으로 불러와 속성들을 가져와 사용할 수 있습니다.\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"CustomAuthorizationRequestResolver 추가하기\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ClientRegistrationRepository를 수정하는 것도 방법이지만 옵션만 추가하는 건데 등록 정보 전부를 불러오는 건 번거로울 수 있습니다.\\n다른 방법으로는 AuthorizationRequestResolver를 구현하는 방법으로 request에 resolver를 추가할 수 있습니다.\\nAuthorizationRequestResolver를 구현하고 나면 추가할 위치는 다음 코드와 같습니다.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@EnableWebSecurity\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@RequiredArgsConstructor\"\n          }), \" \\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"SecurityConfig\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"extends\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"WebSecurityConfigurerAdapter\"\n          }), \" {\\n\\n \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"final\"\n          }), \" ClientRegistrationRepository clientRegistrationRepository;\\n\\n \", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Override\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"protected\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"configure\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(HttpSecurity http)\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"throws\"\n          }), \" Exception {\\n    http.\\n    .oauth2Login()\\n        .authorizationEndpoint()\\n        .authorizationRequestResolver(customAuthorizationRequestResolver))\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"AuthorizationRequestResolver는 ClientRegistrationRepository를 생성 파라미터로 받습니다.\\n이 코드는 Spring docs에서 제공하는 파리미터를 수정하는 코드에서 access_type을 추가한 코드입니다.\\n코드를 살펴보면 생성자로 ClientRegistrationRepository를 주입 받습니다.\\n위에서 ClientRegistationRepository를 수정했다면 중복해서 처리되므로 하나만 선택해서 설정해야 합니다.\\n다음으로 OAuth2AuthorizationRequestResolver로 DefaultOAuth2AuthorizationRequestResolver를 만들어서 사용합니다.\\n구현하는 클래스를 필드값으로 갖고 있는 이유는 DefaultOAuth2AuthorizationRequestResolver는 final 클래스로 상속받을 수 없습니다.\\n상속받을 수 없지만 Spring에서 기본적으로 사용하는 위 클래스가 구현하는 기능이 많기 때문에 가져와서 쓰는 것이 편합니다.\\n모든 기능을 그대로 복사해서 사용해도 되지만 그것도 마찬가지로 중복이 많아지게 됩니다.\\n따라서 필드값으로 사용해서 기본 기능을 실행하고 추가적인 옵션을 넣는 식으로 구현됩니다.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Component\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"CustomAuthorizationRequestResolver\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"implements\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"OAuth2AuthorizationRequestResolver\"\n          }), \" {\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"final\"\n          }), \" OAuth2AuthorizationRequestResolver defaultAuthorizationRequestResolver;\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"CustomAuthorizationRequestResolver\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(\\n      ClientRegistrationRepository clientRegistrationRepository)\"\n          }), \" {\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \".defaultAuthorizationRequestResolver =\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"DefaultOAuth2AuthorizationRequestResolver\"\n          }), \"(\\n            clientRegistrationRepository, \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"/oauth2/authorize\\\"\"\n          }), \");\\n  }\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Override\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" OAuth2AuthorizationRequest \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"resolve\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(HttpServletRequest request)\"\n          }), \" {\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"OAuth2AuthorizationRequest\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"authorizationRequest\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \".defaultAuthorizationRequestResolver.resolve(request);\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" authorizationRequest != \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \" ?\\n        customAuthorizationRequest(authorizationRequest) :\\n        \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \";\\n  }\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@Override\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"public\"\n          }), \" OAuth2AuthorizationRequest \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"resolve\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(\\n      HttpServletRequest request, String clientRegistrationId)\"\n          }), \" {\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"OAuth2AuthorizationRequest\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"authorizationRequest\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \"\\n        \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"this\"\n          }), \".defaultAuthorizationRequestResolver.resolve(\\n            request, clientRegistrationId);\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" authorizationRequest != \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \" ?\\n        customAuthorizationRequest(authorizationRequest) :\\n        \", _jsx(_components.span, {\n            className: \"hljs-literal\",\n            children: \"null\"\n          }), \";\\n  }\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" OAuth2AuthorizationRequest \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"customAuthorizationRequest\"\n          }), _jsx(_components.span, {\n            className: \"hljs-params\",\n            children: \"(\\n      OAuth2AuthorizationRequest authorizationRequest)\"\n          }), \" {\\n\\n    Map\u003cString, Object\u003e additionalParameters =\\n        \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-class\",\n            children: \"LinkedHashMap\"\n          }), \"\u003c\u003e(authorizationRequest.getAdditionalParameters());\\n    additionalParameters.put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"access_type\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"offline\\\"\"\n          }), \");\\n    additionalParameters.put(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"prompt\\\"\"\n          }), \", \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"consent\\\"\"\n          }), \");\\n\\n    \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"return\"\n          }), \" OAuth2AuthorizationRequest.from(authorizationRequest)\\n        .additionalParameters(additionalParameters)\\n        .build();\\n  }\\n}\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Refresh Token 사용하기\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"위에서 받아온 Refresh Token은 \", _jsx(_components.code, {\n          children: \"OAuth2AuthorizedClientService\"\n        }), \"에서 관리됩니다.\\n따라서 사용할 클래스에서 Bean으로 주입받고 사용하면 됩니다.\\nOAuth2AuthorizedClientService에서 loadAuthorizedClient로 저장된 정보를 불러와 사용할 수 있습니다.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"private\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"final\"\n          }), \" OAuth2AuthorizedClientService oAuth2AuthorizedClientService;\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"OAuth2AuthorizedClient\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"user\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" oAuth2AuthorizedClientService.loadAuthorizedClient(\", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"google\\\"\"\n          }), \", authentication.getName());\\n  \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"OAuth2RefreshToken\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"refreshToken\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" user.getRefreshToken();\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Controller에서 사용하는 경우 다른 방법으로 받을 수 있습니다.\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-java\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-meta\",\n            children: \"@GetMapping(\\\"/foo\\\")\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-keyword\",\n            children: \"void\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-title hljs-function\",\n            children: \"foo\"\n          }), _jsxs(_components.span, {\n            className: \"hljs-params\",\n            children: [\"(\", _jsx(_components.span, {\n              className: \"hljs-meta\",\n              children: \"@RegisteredOAuth2AuthorizedClient(\\\"google\\\")\"\n            }), \" OAuth2AuthorizedClient user)\"]\n          }), \" {\\n    \", _jsx(_components.span, {\n            className: \"hljs-type\",\n            children: \"OAuth2RefreshToken\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-variable\",\n            children: \"refreshToken\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-operator\",\n            children: \"=\"\n          }), \" user.getRefreshToken();\\n}\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsx(_components.p, {\n        children: \"이렇게 정리한 이유는 OAuth2 Access Token만으로 구현한 글들은 많이 접할 수 있었지만 Refresh Token은 많이 없었습니다.\\n로그인이 아니라 API를 호출하는 경우 이후에 토큰을 갱신하기 위해서 필요한데 생길 수 있는 문제를 정리해봤습니다.\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"Spring Security OAuth2 Client"},"buildId":"C_hZnuebhS8O93_BuECK4","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>