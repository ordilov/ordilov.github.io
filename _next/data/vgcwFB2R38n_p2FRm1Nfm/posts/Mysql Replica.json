{"pageProps":{"metadata":{"title":"Docker Mysql Replication","date":"2022-04-25 00:01:00 +0900","category":"database","tags":["backend"],"keywords":["backend"],"description":"Docker로 Mysql을 Replication 자동화하는 방법을 알아봅니다.","type":"archive","id":"Mysql Replica"},"mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      h2: \"h2\",\n      h3: \"h3\",\n      pre: \"pre\",\n      code: \"code\",\n      span: \"span\",\n      blockquote: \"blockquote\",\n      p: \"p\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.h2, {\n        children: \"설정 파일 구성\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"master my.cnf\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-ini\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-section\",\n            children: \"[mysqld]\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"log_bin\"\n          }), \" = mysql-bin\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"server_id\"\n          }), \" = \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"1\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"default_authentication_plugin\"\n          }), \"=mysql_native_password\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"slave my.cnf\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-ini\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-section\",\n            children: \"[mysqld]\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"log_bin\"\n          }), \" = mysql-bin\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"server_id\"\n          }), \" = \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"2\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"relay_log\"\n          }), \" = /var/lib/mysql/mysql-relay-bin\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"log_slave_updates\"\n          }), \" = \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"1\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"read_only\"\n          }), \" = \", _jsx(_components.span, {\n            className: \"hljs-number\",\n            children: \"1\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"default_authentication_plugin\"\n          }), \"=mysql_native_password\\n\"]\n        })\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Dockerfile 구성\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-bash\",\n          children: [\"FROM mysql\\nCOPY ./master/my.cnf /etc/mysql/my.cnf\\nRUN \", _jsx(_components.span, {\n            className: \"hljs-built_in\",\n            children: \"chmod\"\n          }), \" 644 /etc/mysql/my.cnf\\n\"]\n        })\n      }), \"\\n\", _jsxs(_components.blockquote, {\n        children: [\"\\n\", _jsxs(_components.p, {\n          children: [\"mysql: [Warning] World-writable config file '/etc/mysql/my.cnf' is ignored.\\n윈도우를 쓰는 경우 볼 수 있는 에러인데 파일 권한을 변경해줘야 해서 \", _jsx(_components.code, {\n            children: \"chmod\"\n          }), \" 명령어를 사용합니다.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"설정 파일 구성\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Docker Compose 구성\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsxs(_components.code, {\n          className: \"hljs language-yml\",\n          children: [_jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"version:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"\\\"3.9\\\"\"\n          }), \"\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"services:\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"db-master:\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"container_name:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"master\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"build:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"context:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"./\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"dockerfile:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"master/Dockerfile\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"restart:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"always\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"environment:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_DATABASE:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'db'\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_USER:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'user'\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_PASSWORD:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'password'\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_ROOT_PASSWORD:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'password'\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"ports:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'3306:3306'\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"volumes:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"my-db-master:/var/lib/mysql\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"my-db-master:/var/lib/mysql-files\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"networks:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"mysql-replica\"\n          }), \"\\n\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"db-slave:\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"container_name:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"slave\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"build:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"context:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"./\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"dockerfile:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"slave/Dockerfile\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"restart:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"always\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"environment:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_DATABASE:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'db'\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_USER:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'user'\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_PASSWORD:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'password'\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"MYSQL_ROOT_PASSWORD:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'password'\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"ports:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"'3307:3306'\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"volumes:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"my-db-slave:/var/lib/mysql\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"my-db-slave:/var/lib/mysql-files\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"networks:\"\n          }), \"\\n      \", _jsx(_components.span, {\n            className: \"hljs-bullet\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"mysql-replica\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"volumes:\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"my-db-master:\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"my-db-slave:\"\n          }), \"\\n\\n\", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"networks:\"\n          }), \"\\n  \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"mysql-replica:\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"driver:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"bridge\"\n          }), \"\\n    \", _jsx(_components.span, {\n            className: \"hljs-attr\",\n            children: \"name:\"\n          }), \" \", _jsx(_components.span, {\n            className: \"hljs-string\",\n            children: \"mysql-replica\"\n          }), \"\\n\"]\n        })\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true}